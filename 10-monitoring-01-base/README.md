# Домашнее задание к занятию "10.01. Зачем и что нужно мониторить"

## Обязательные задания

1. Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя 
платформу для вычислений с выдачей текстовых отчетов, которые сохраняются на диск. Взаимодействие с платформой 
осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?



Для измерения  CPU  могут подойти следующие измерения:

    -  Latency: средняя или максимальная задержка в планировщике процессора
    -  Traffic: загрузка процессора
    - Ошибки: специфические ошибки процессора, неисправные процессоры
    - Насыщенность: Выполнить длину очереди

Для  memory  сигналы могут выглядеть следующим образом:

    - Латентность: (нет - сложно найти хороший метод измерения и не работает)
    - Traffic: объем используемой памяти
    -  Ошибки: ошибки нехватки памяти
    - Насыщенность: события OOM killer, использование свопа

Для  запоминающих устройств:
    - Latency: среднее время ожидания (+ await +) для чтения и записи
    - Traffic: чтение и запись уровней ввода / вывода
    - Ошибки: ошибки файловой системы, ошибки диска в + / sys / devices +
    - Насыщенность: глубина очереди ввода / вывода

    Сетевые * сигналы могут выглядеть следующим образом:

    - Задержка: Очередь сетевого драйвера
    - Traffic: входящие и исходящие байты или пакеты в секунду
    - Ошибки: ошибки сетевого устройства, пропущенные пакеты
    - Насыщенность: переполнение, отброшенные пакеты, повторно переданные сегменты

Для приложения, которoе обслуживаeт клиентов:

    - Латентность: время выполнения запросов
    - Traffic: количество запросов в секунду
    - Ошибки: ошибки приложения, возникающие при обработке клиентских запросов или обращении к ресурсам.
    - Насыщенность: процент или количество ресурсов, используемых в настоящее время


2. Менеджер продукта посмотрев на ваши метрики сказал, что ему непонятно что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?

Объясню ему, что без мониторинга нельзя понять, вписывается ли команда в бюджет и соблюдает ли критерии, описанные в SLO. Поэтому задача инженера по SRE — настроить мониторинг. Причём настроить его так, чтобы уведомления приходили только тогда, когда требуются действия. Также скачем, что чем надёжнее система, тем дороже она стоит. Поэтому определили самый низкий уровень надёжности, который может сойти нам с рук, и указали его в качестве SLO Сойти с рук — значит, что пользователи не заметят разницы или заметят, но это не повлияет на их удовлетворенность сервисом.

3. Вашей DevOps команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики в свою очередь хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?

- Использовать open source решения для сборки логов (Logstash, Graylog и.т.д) или предложить использовать метрики для подсчёта количества ошибок разного типа и заменить ими логи.

4. Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA=99% по http кодам ответов. 
Вычисляете этот параметр по следующей формуле: summ_2xx_requests/summ_all_requests. Данный параметр не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?

Ошиба в вичисляемой формуле. В 99% случаев мы должны отдавать http коды отличный от 4xx/5xx. 1% выделяется на техническое обслуживание.
Расчет SLI может выглядеть таким образом:
SLI = (summ_2xx_requests + summ_3xx_requests)/(summ_all_requests)

## Дополнительное задание (со звездочкой*) - необязательно к выполнению

```
#!/usr/bin/python3

import datetime, time
import os

def write_to_file(filename, data):
  with open(f'/tmp/{filename}', 'a+') as f:
    f.write(f'{data}\n')


def main():
  date = datetime.datetime.now().strftime("%Y-%m-%d")
  filename = f'{date}-awesome-monitoring.log'
  metrics_time = int(time.time())
  write_to_file(filename, metrics_time)
  mertics = os.system(f"cat /proc/loadavg /proc/uptime /proc/swaps >> /tmp/{filename}")

if __name__ == '__main__':
    main()
```

```
crontab -l
* * * * * /home/q/devops-netology/10-monitoring-01-base/collection_of_metrics.py

10-monitoring-01-base ► cat /tmp/2022-09-26-awesome-monitoring.log 
1664200201
0.62 0.22 0.08 1/563 1304
73.23 539.10
Filename				Type		Size		Used		Priority
/swapfile                               file		2097148		0		-2
1664200261
0.26 0.19 0.08 2/569 1354
133.29 994.78
Filename				Type		Size		Used		Priority
/swapfile                               file		2097148		0		-2
1664200321
0.43 0.27 0.11 1/615 1446
193.35 1428.82
Filename				Type		Size		Used		Priority
/swapfile                               file		2097148		0		-2
1664200381
0.42 0.31 0.13 2/609 1459
253.41 1831.95
Filename				Type		Size		Used		Priority
/swapfile                               file		2097148		0		-2
1664200441
0.81 0.45 0.19 1/601 1470
313.46 2236.55
Filename				Type		Size		Used		Priority
/swapfile                               file		2097148		0		-2
1664200501
1.57 0.73 0.31 5/589 1485
373.52 2638.28
Filename				Type		Size		Used		Priority
/swapfile                               file		2097148		0		-2
1664200561
1.50 0.87 0.38 1/585 1492
433.58 3043.61
Filename				Type		Size		Used		Priority
/swapfile                               file		2097148		0		-2
1664200621
1.06 0.89 0.42 1/582 1506
493.61 3451.88
Filename				Type		Size		Used		Priority
/swapfile                               file		2097148		0		-2
1664200681
0.64 0.80 0.42 4/580 1518
553.67 3870.98
Filename				Type		Size		Used		Priority
/swapfile                               file		2097148		0		-2
```
